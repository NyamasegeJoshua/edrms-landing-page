<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="csrf-token" content="WCdfJy4VcTcFPFczChV7CBIAI0UIEgd9oo7fJy7VRknr_qMfMIjh_gO0" />
    <title data-suffix="">Govt EDRMS</title>
    <link rel="canonical" href="https://crs.ecitizen.go.ke" />
    <link rel="icon" type="image/x-icon" href="images/favicon-e1bdc604c7b0f9bc8d82ac3226892df2.ico" />
    <link phx-track-static rel="stylesheet" href="assets/main-19eca7b2e7656617bc169bee5136883e.css" />
    <!-- tailwind css -->
    <link rel="stylesheet" href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" />
    <!-- google font -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/stye.css">
    <link phx-track-static rel="stylesheet" href="assets/app-ced38148c650510e515759b66aeb3e30.css" />
    <style>
        #myScript {
            visibility: hidden;
        }
    </style>
    <script defer phx-track-static type="text/javascript" id="myScript"
        src="/assets/app-afd6b69306582c548fae7ef3c36bdacd.js?vsn=d"></script>
    <script id="myScript" src="/highcharts.js"></script>
</head>

<body class="h-full">
    <h1 class="text-lg font-bold text-gray-700 leading-tight text-center mt-12 mb-5">
        Create New Ministry
    </h1>
    <div class="form-container">
        <form id="signUpForm"
            class="p-12 shadow-md rounded-2xl bg-white mx-auto border-solid border-2 border-gray-100 mb-8" action="#!">
            <!-- start step indicators -->
            <div class="form-header flex gap-3 mb-4 text-xs text-center">
                <span class="stepIndicator flex-1 pb-8 relative">Admin Authentication</span>
                <span class="stepIndicator flex-1 pb-8 relative">MCDA General Info</span>
                <span class="stepIndicator flex-1 pb-8 relative">System Config Details</span>
                <span class="stepIndicator flex-1 pb-8 relative">Database Creation</span>
            </div>
            <!-- end step indicators -->
            
            <!-- step two -->
            <div class="step">
                <p class="text-full text-gray-700 leading-tight text-center mt-8 mb-5">
                    Ministry/Agency General Info
                </p>
                <div class="mb-4">
                    <input type="text" placeholder="Name (Must be unique)" name="ministryName"
                        class="w-full px-3 py-2 text-sm rounded-full text-gray-700 font-medium border border-gray-300"
                        oninput="this.className = 'w-full px-3 py-2 rounded-full text-gray-700 font-medium border border-gray-300'"
                        required />
                </div>
                <div class="mb-4">
                    <input type="text" placeholder="Onboarding ID (Must be unique)" name="onboardingID"
                        class="w-full text-sm px-3 py-2 rounded-full text-gray-700 font-medium border border-gray-300"
                        oninput="this.className = 'w-full px-3 py-2 rounded-full text-gray-700 font-medium border border-gray-300'"
                        required />
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 font-medium">Logo Upload</label>
                    <input type="file" name="logo" accept="image/*"
                        class="w-full text-sm py-2 border border-gray-300" />
                </div>
                <div class="mb-4">
                    <textarea placeholder="Type and submit Ministry/Agency Description" name="description"
                        class="w-full px-3 py-2 text-sm rounded-full text-gray-700 font-medium border border-gray-300"
                        oninput="this.className = 'w-full px-3 py-2 rounded-full text-gray-700 font-medium border border-gray-300'"
                        required></textarea>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 font-medium">Category</label>
                    <select id="category"
                        class="w-full px-3 text-sm py-2 rounded-full text-gray-700 font-medium border border-gray-300"
                        required>
                        <option value="" disabled selected>Select Category</option>
                        <option value="ministry">Ministry</option>
                        <option value="agency">Agency</option>
                        <option value="state_department">State Department</option>
                    </select>
                </div>
                <div class="mb-4" id="ministrySelection" style="display:none;">
                    <label class="block text-gray-700 font-medium">Ministry Belonging</label>
                    <input type="text" placeholder="Enter Ministry Name" name="ministryBelonging"
                        class="w-full px-3 py-2 rounded-full text-gray-700 text-sm font-medium border border-gray-300" />
                </div>
            </div>

            <!-- step three -->
            <div class="step">
                <p class="text-full text-gray-700 leading-tight text-center mt-8 mb-5">
                    System Configuration Details
                </p>
                <div class="mb-6">
                    <input type="text" placeholder="HTTP Connector Port" name="httpConnectorPort"
                        class="w-full px-4 py-3 rounded-full text-gray-700 font-medium border-solid border-2 border-gray-200"
                        oninput="this.className = 'w-full px-4 py-3 rounded-full text-gray-700 font-medium border-solid border-2 border-gray-200'" />
                </div>
                <div class="mb-6">
                    <input type="text" placeholder="HTTPS Connector Port" name="httpsConnectorPort"
                        class="w-full px-4 py-3 rounded-full text-gray-700 font-medium border-solid border-2 border-gray-200"
                        oninput="this.className = 'w-full px-4 py-3 rounded-full text-gray-700 font-medium border-solid border-2 border-gray-200'" />
                </div>
                <div class="mb-6">
                    <input type="text" placeholder="AJB Connector Port" name="ajbConnectorPort"
                        class="w-full px-4 py-3 rounded-full text-gray-700 font-medium border-solid border-2 border-gray-200"
                        oninput="this.className = 'w-full px-4 py-3 rounded-full text-gray-700 font-medium border-solid border-2 border-gray-200'" />
                </div>
                <!-- Add more fields as needed for system configuration details -->
            </div>
            <!-- start previous / next buttons -->
            <!-- Next and Previous buttons -->
            <button type="button" id="prevBtn"
                class="inline-block rounded bg-neutral-50 px-6 pb-2 pt-2.5 text-xs font-medium uppercase leading-normal text-neutral-800 shadow-[0_4px_9px_-4px_#cbcbcb] transition duration-150 ease-in-out hover:bg-neutral-100 hover:shadow-[0_8px_9px_-4px_rgba(203,203,203,0.3),0_4px_18px_0_rgba(203,203,203,0.2)] focus:bg-neutral-100 focus:shadow-[0_8px_9px_-4px_rgba(203,203,203,0.3),0_4px_18px_0_rgba(203,203,203,0.2)] focus:outline-none focus:ring-0 active:bg-neutral-200 active:shadow-[0_8px_9px_-4px_rgba(203,203,203,0.3),0_4px_18px_0_rgba(203,203,203,0.2)] dark:shadow-[0_4px_9px_-4px_rgba(251,251,251,0.3)] dark:hover:shadow-[0_8px_9px_-4px_rgba(251,251,251,0.1),0_4px_18px_0_rgba(251,251,251,0.05)] dark:focus:shadow-[0_8px_9px_-4px_rgba(251,251,251,0.1),0_4px_18px_0_rgba(251,251,251,0.05)] dark:active:shadow-[0_8px_9px_-4px_rgba(251,251,251,0.1),0_4px_18px_0_rgba(251,251,251,0.05)]"
                onclick="nextPrev(-1)">
                Previous
            </button>
            <!-- Next and Previous buttons -->
            <button type="button" id="nextBtn"
                class="inline-block rounded bg-neutral-800 px-6 pb-2 pt-2.5 text-xs font-medium uppercase leading-normal text-neutral-50 shadow-[0_4px_9px_-4px_rgba(51,45,45,0.7)] transition duration-150 ease-in-out hover:bg-neutral-800 hover:shadow-[0_8px_9px_-4px_rgba(51,45,45,0.2),0_4px_18px_0_rgba(51,45,45,0.1)] focus:bg-neutral-800 focus:shadow-[0_8px_9px_-4px_rgba(51,45,45,0.2),0_4px_18px_0_rgba(51,45,45,0.1)] focus:outline-none focus:ring-0 active:bg-neutral-900 active:shadow-[0_8px_9px_-4px_rgba(51,45,45,0.2),0_4px_18px_0_rgba(51,45,45,0.1)] dark:bg-neutral-900 dark:shadow-[0_4px_9px_-4px_#030202] dark:hover:bg-neutral-900 dark:hover:shadow-[0_8px_9px_-4px_rgba(3,2,2,0.3),0_4px_18px_0_rgba(3,2,2,0.2)] dark:focus:bg-neutral-900 dark:focus:shadow-[0_8px_9px_-4px_rgba(3,2,2,0.3),0_4px_18px_0_rgba(3,2,2,0.2)] dark:active:bg-neutral-900 dark:active:shadow-[0_8px_9px_-4px_rgba(3,2,2,0.3),0_4px_18px_0_rgba(3,2,2,0.2)]"
                onclick="nextPrev(1)">
                <span id="loadingSpinner" class="hidden">Loading...</span>
                <span class="text-red-500 active:text-white">Next</span>
            </button>
            <!-- end previous / next buttons -->
        </form>
    </div>
    <!-- Place these scripts at the end of your body before </body> tag -->
    <script>
        var currentTab = 0;

        function showTab(n) {
            var x = document.getElementsByClassName("step");
            x[currentTab].style.display = "none";
            currentTab = n;
            x[currentTab].style.display = "block";

            document.getElementById("prevBtn").style.display = currentTab === 0 ? "none" : "inline";
            document.getElementById("nextBtn").innerHTML = currentTab === x.length - 1 ? "Submit" : "Next";
        }

        function nextPrev(n) {
            var x = document.getElementsByClassName("step");

            if (n === 1 && !validateForm()) return false;

            x[currentTab].style.display = "none";
            currentTab += n;

            if (currentTab >= x.length) {
                document.getElementById("signUpForm").submit();
                return false;
            }

            showTab(currentTab);
        }

        function validateForm() {
            var x, y, i, valid = true;
            x = document.getElementsByClassName("step");
            y = x[currentTab].getElementsByTagName("input");
            var category = document.getElementById("category").value;
            var ministrySelection = document.getElementById("ministrySelection");
    
            for (i = 0; i < y.length; i++) {
                if (y[i].hasAttribute("required") && y[i].value.trim() === "") {
                    valid = false;
                    break;
                }
            }
    
            if (category !== "ministry" && ministrySelection.style.display !== "none") {
                var ministryBelongingField = document.getElementsByName("ministryBelonging")[0];
                if (ministryBelongingField.value.trim() === "") {
                    valid = false;
                    alert("Please specify the ministry it belongs to proceed.");
                }
            }
    
            // You can add more complex validation logic as needed
    
            if (valid) {
                document.getElementsByClassName("stepIndicator")[currentTab].className += " finish";
            }
    
            return valid;
        }
        
        function showMinistryBelongingField() {
            var categorySelect = document.getElementById("category");
            var ministrySelection = document.getElementById("ministrySelection");
    
            if (categorySelect.value === "ministry") {
                ministrySelection.style.display = "none";
            } else {
                ministrySelection.style.display = "block";
            }
        }
    
        document.getElementById("category").addEventListener("change", showMinistryBelongingField);
        showMinistryBelongingField();

        showTab(currentTab); // Display the initial tab
    </script>
    <!-- Include this script in your HTML file -->
<script>
    // Function to display a loading spinner
    function showLoadingSpinner() {
        // Create a loading overlay
        const loadingOverlay = document.createElement('div');
        loadingOverlay.className = 'loading-overlay';

        // Create a spinner
        const spinner = document.createElement('div');
        spinner.className = 'spinner';
        spinner.innerHTML = '<div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div>';

        // Append the spinner to the loading overlay
        loadingOverlay.appendChild(spinner);

        // Append the loading overlay to the body
        document.body.appendChild(loadingOverlay);
    }

    // Function to hide the loading spinner
    function hideLoadingSpinner() {
        // Remove the loading overlay from the DOM
        const loadingOverlay = document.querySelector('.loading-overlay');
        if (loadingOverlay) {
            document.body.removeChild(loadingOverlay);
        }
    }

    // Function to handle the form submission and initiate the unzipping process
    async function handleFormSubmission() {
        try {
            // Show loading spinner
            showLoadingSpinner();

            // Fetch to the server endpoint responsible for unzipping
            const response = await fetch('/unzip', {
                method: 'POST',
            });

            // Check if unzipping was successful
            if (response.ok) {
                // If successful, proceed to the next step (change this URL accordingly)
                window.location.href = '/next-page.html';
            } else {
                // If unzipping failed, display an error message or handle it accordingly
                console.error('Unzipping failed:', response.statusText);
                // Optionally, you can redirect to an error page or show an error message
            }
        } catch (error) {
            console.error('Error during form submission:', error);
            // Handle other errors as needed
        } finally {
            // Hide loading spinner after the process is complete
            hideLoadingSpinner();
        }
    }

    // Attach the handleFormSubmission function to the click event of the "Next" button
    document.getElementById('nextButton').addEventListener('click', handleFormSubmission);
</script>

<!-- Include this style in your HTML or in your CSS file -->
<style>
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.8); /* Adjust the background color and opacity */
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000; /* Adjust the z-index as needed */
    }

    .spinner {
        width: 40px;
        height: 40px;
        margin: 100px auto;
        background-color: #333;

        border-radius: 100%;
        animation: sk-bounce 1.4s infinite ease-in-out;
    }

    .spinner > div {
        width: 18px;
        height: 18px;
        background-color: #333;

        border-radius: 100%;
        display: inline-block;
        animation: sk-bounce-dot 1.4s infinite ease-in-out;
    }

    @keyframes sk-bounce {
        0%, 100% {
            transform: scale(0);
        } 50% {
            transform: scale(1);
        }
    }

    @keyframes sk-bounce-dot {
        0%, 100% {
            transform: translateY(0);
        } 50% {
            transform: translateY(-18px);
        }
    }
</style>

</body>
</html>